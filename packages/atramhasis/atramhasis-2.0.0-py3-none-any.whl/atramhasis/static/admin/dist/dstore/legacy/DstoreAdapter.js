//>>built
define("dstore/legacy/DstoreAdapter",["dojo/_base/declare","dojo/_base/array","dojo/store/util/QueryResults"],function(n,h,p){function g(d){return d}var m={store:null,constructor:function(d){this.store=d;if(d._getQuerierFactory("filter")||d._getQuerierFactory("sort"))this.queryEngine=function(a,c){c=c||{};var b=d._getQuerierFactory("filter"),q=b?b(a):g;b=d._getQuerierFactory("sort");var e=g;b&&(e=b(h.map(c.sort,function(a){return{property:a.attribute,descending:a.descending}})));var l=g;isNaN(c.start)&&
isNaN(c.count)||(l=function(a){var b=c.start||0;b=a.slice(b,b+(c.count||Infinity));b.total=a.length;return b});return function(a){return l(e(q(a)))}};var b=this;d.on("add,update,delete",function(a){var c=a.type,f=a.target;b.notify("add"===c||"update"===c?f:void 0,"delete"===c||"update"===c?"id"in a?a.id:d.getIdentity(f):void 0)})},query:function(d,b){b=b||{};var a=this.store.filter(d),c;if(c=b.sort)if("[object Array]"===Object.prototype.toString.call(c))for(var f;f=c.pop();)a=a.sort(f.attribute,f.descending);
else a=a.sort(c);if(a.track&&!a.tracking){a=a.track();var g=!0}if("start"in b){var e=b.start||0;e=a[a.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:e,end:b.count?e+b.count:Infinity})}e=e||a[a.fetchSync?"fetchSync":"fetch"]();c=e.totalLength;e=new p(e);e.total=c;e.observe=function(b,c){function d(a){return void 0===a&&g?-1:a}var e=a.on("add",function(a){b(a.target,-1,d(a.index))}),f=a.on("update",function(a){!c&&a.previousIndex===a.index&&isFinite(a.index)||b(a.target,d(a.previousIndex),d(a.index))}),
h=a.on("delete",function(a){b(a.target,d(a.previousIndex),-1)}),k={remove:function(){e.remove();f.remove();h.remove()}};k.cancel=k.remove;return k};return e},notify:function(){}};h.forEach(["get","put","add","remove","getIdentity"],function(d){m[d]=function(){var b=this.store;return(b[d+"Sync"]||b[d]).apply(b,arguments)}});return n(null,m)});
//# sourceMappingURL=DstoreAdapter.js.map