//>>built
define("dojo/_base/xhr","./kernel ./sniff require ../io-query ../dom ../dom-form ./Deferred ./config ./json ./lang ./array ../on ../aspect ../request/watch ../request/xhr ../request/util".split(" "),function(b,t,F,r,z,l,A,G,v,q,B,H,w,n,x,C){b._xhrObj=x._create;var u=b.config;b.objectToQuery=r.objectToQuery;b.queryToObject=r.queryToObject;b.fieldToObject=l.fieldToObject;b.formToObject=l.toObject;b.formToQuery=l.toQuery;b.formToJson=l.toJson;b._blockAsync=!1;var p=b._contentHandlers=b.contentHandlers=
{text:function(a){return a.responseText},json:function(a){return v.fromJson(a.responseText||null)},"json-comment-filtered":function(a){a=a.responseText;var b=a.indexOf("/*"),e=a.lastIndexOf("*/");if(-1==b||-1==e)throw Error("JSON was not comment filtered");return v.fromJson(a.substring(b+2,e))},javascript:function(a){return b.eval(a.responseText)},xml:function(a){var b=a.responseXML;b&&t("dom-qsa2.1")&&!b.querySelectorAll&&t("dom-parser")&&(b=(new DOMParser).parseFromString(a.responseText,"application/xml"));
if(t("ie")&&(!b||!b.documentElement)){var e=function(a){return"MSXML"+a+".DOMDocument"};e=["Microsoft.XMLDOM",e(6),e(4),e(3),e(2)];B.some(e,function(d){try{var c=new ActiveXObject(d);c.async=!1;c.loadXML(a.responseText);b=c}catch(f){return!1}return!0})}return b},"json-comment-optional":function(a){return a.responseText&&/^[^{\[]*\/\*/.test(a.responseText)?p["json-comment-filtered"](a):p.json(a)}};b._ioSetArgs=function(a,d,e,h){var c={args:a,url:a.url},f=null;if(a.form){f=z.byId(a.form);var k=f.getAttributeNode("action");
c.url=c.url||(k?k.value:b.doc?b.doc.URL:null);f=l.toObject(f)}k={};f&&q.mixin(k,f);a.content&&q.mixin(k,a.content);a.preventCache&&(k["dojo.preventCache"]=(new Date).valueOf());c.query=r.objectToQuery(k);c.handleAs=a.handleAs||"text";var g=new A(function(a){a.canceled=!0;d&&d(a);var b=a.ioArgs.error;b||(b=Error("request cancelled"),b.dojoType="cancel",a.ioArgs.error=b);return b});g.addCallback(e);var m=a.load;m&&q.isFunction(m)&&g.addCallback(function(b){return m.call(a,b,c)});var n=a.error;n&&q.isFunction(n)&&
g.addErrback(function(b){return n.call(a,b,c)});var p=a.handle;p&&q.isFunction(p)&&g.addBoth(function(b){return p.call(a,b,c)});g.addErrback(function(a){return h(a,g)});u.ioPublish&&b.publish&&!1!==c.args.ioPublish&&(g.addCallbacks(function(a){b.publish("/dojo/io/load",[g,a]);return a},function(a){b.publish("/dojo/io/error",[g,a]);return a}),g.addBoth(function(a){b.publish("/dojo/io/done",[g,a]);return a}));g.ioArgs=c;return g};var D=function(a){a=p[a.ioArgs.handleAs](a.ioArgs.xhr);return void 0===
a?null:a},E=function(a,b){return a},y=function(a){0>=m&&(m=0,u.ioPublish&&b.publish&&(!a||a&&!1!==a.ioArgs.args.ioPublish)&&b.publish("/dojo/io/stop"))},m=0;w.after(n,"_onAction",function(){--m});w.after(n,"_onInFlight",y);b._ioCancelAll=n.cancelAll;b._ioNotifyStart=function(a){u.ioPublish&&b.publish&&!1!==a.ioArgs.args.ioPublish&&(m||b.publish("/dojo/io/start"),m+=1,b.publish("/dojo/io/send",[a]))};b._ioWatch=function(a,b,e,h){a.ioArgs.options=a.ioArgs.args;q.mixin(a,{response:a.ioArgs,isValid:function(c){return b(a)},
isReady:function(b){return e(a)},handleResponse:function(b){return h(a)}});n(a);y(a)};b._ioAddQueryToUrl=function(a){a.query.length&&(a.url+=(-1==a.url.indexOf("?")?"?":"\x26")+a.query,a.query=null)};b.xhr=function(a,d,e){var h=b._ioSetArgs(d,function(a){k&&k.cancel()},D,E),c=h.ioArgs;"postData"in d?c.query=d.postData:"putData"in d?c.query=d.putData:"rawBody"in d?c.query=d.rawBody:(2<arguments.length&&!e||-1==="POST|PUT".indexOf(a.toUpperCase()))&&b._ioAddQueryToUrl(c);var f={method:a,handleAs:"text",
timeout:d.timeout,withCredentials:d.withCredentials,ioArgs:c};"undefined"!==typeof d.headers&&(f.headers=d.headers);"undefined"!==typeof d.contentType&&(f.headers||(f.headers={}),f.headers["Content-Type"]=d.contentType);"undefined"!==typeof c.query&&(f.data=c.query);"undefined"!==typeof d.sync&&(f.sync=d.sync);b._ioNotifyStart(h);try{var k=x(c.url,f,!0)}catch(g){return h.cancel(),h}h.ioArgs.xhr=k.response.xhr;k.then(function(){h.resolve(h)}).otherwise(function(a){c.error=a;a.response&&(a.status=a.response.status,
a.responseText=a.response.text,a.xhr=a.response.xhr);h.reject(a)});return h};b.xhrGet=function(a){return b.xhr("GET",a)};b.rawXhrPost=b.xhrPost=function(a){return b.xhr("POST",a,!0)};b.rawXhrPut=b.xhrPut=function(a){return b.xhr("PUT",a,!0)};b.xhrDelete=function(a){return b.xhr("DELETE",a)};b._isDocumentOk=function(a){return C.checkStatus(a.status)};b._getText=function(a){var d;b.xhrGet({url:a,sync:!0,load:function(a){d=a}});return d};q.mixin(b.xhr,{_xhrObj:b._xhrObj,fieldToObject:l.fieldToObject,
formToObject:l.toObject,objectToQuery:r.objectToQuery,formToQuery:l.toQuery,formToJson:l.toJson,queryToObject:r.queryToObject,contentHandlers:p,_ioSetArgs:b._ioSetArgs,_ioCancelAll:b._ioCancelAll,_ioNotifyStart:b._ioNotifyStart,_ioWatch:b._ioWatch,_ioAddQueryToUrl:b._ioAddQueryToUrl,_isDocumentOk:b._isDocumentOk,_getText:b._getText,get:b.xhrGet,post:b.xhrPost,put:b.xhrPut,del:b.xhrDelete});return b.xhr});
//# sourceMappingURL=xhr.js.map