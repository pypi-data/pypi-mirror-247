//>>built
define("dgrid/Tree","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/aspect dojo/dom-construct dojo/dom-class dojo/on dojo/query dojo/when ./util/has-css3 ./Grid dojo/has!touch?./util/touch".split(" "),function(x,y,z,C,n,k,A,t,B,u,D,p){return x(null,{collapseOnRefresh:!1,enableTreeTransitions:!0,treeIndentWidth:9,constructor:function(){this._treeColumnListeners=[]},shouldExpand:function(a,b,c){return c},expand:function(a,b,c){if(this._treeColumn){var d=this,f=a.element?a:this.row(a),g=!!this._expanded[f.id],
l=u("transitionend");a=f.element;a=-1<a.className.indexOf("dgrid-expando-icon")?a:t(".dgrid-expando-icon",a)[0];c=c||!this.enableTreeTransitions;if(a&&a.mayHaveChildren&&(c||b!==g)){var h=void 0===b?!this._expanded[f.id]:b;k.replace(a,"ui-icon-triangle-1-"+(h?"se":"e"),"ui-icon-triangle-1-"+(h?"e":"se"));k.toggle(f.element,"dgrid-row-expanded",h);b=f.element;var e=b.connected,r={};if(!e){e=r.container=b.connected=n.create("div",{className:"dgrid-tree-container"},b,"after");var q=function(a){var b=
d._renderedCollection.getChildren(f.data);d.sort&&0<d.sort.length&&(b=b.sort(d.sort));b.track&&d.shouldTrackCollection&&(e._rows=a.rows=[],b=b.track(),e._handles=[b.tracking,d._observeCollection(b,e,a)]);return"start"in a?b.fetchRange({start:a.start,end:a.start+a.count}):b.fetch()};"level"in a&&(e.level=q.level=a.level+1);if(this.renderQuery)var v=this.renderQuery(q,r);else{var w=n.create("div",null,e);v=this._trackError(function(){return d.renderQueryResults(q(r),w,y.mixin({rows:r.rows},"level"in
q?{queryLevel:q.level}:null)).then(function(a){n.destroy(w);return a})})}l&&A(e,l,this._onTreeTransitionEnd)}e.hidden=!h;var m=e.style;if(!l||c)m.display=h?"block":"none",m.height="";else{if(h){m.display="block";var p=e.scrollHeight;m.height="0px"}else k.add(e,"dgrid-tree-resetting"),m.height=e.scrollHeight+"px";setTimeout(function(){k.remove(e,"dgrid-tree-resetting");m.height=h?p?p+"px":"auto":"0px"},0)}h?this._expanded[f.id]=!0:delete this._expanded[f.id]}return B(v)}},_configColumns:function(){var a=
this.inherited(arguments);this._expanded={};for(var b=0,c=a.length;b<c;b++)if(a[b].renderExpando){this._configureTreeColumn(a[b]);break}return a},insertRow:function(a,b,c,d,f){f=f||{};var g=f.queryLevel="queryLevel"in f?f.queryLevel:"level"in b?b.level:0,l=this.inherited(arguments),h=this.row(l);(g=this.shouldExpand(h,g,this._expanded[h.id]))&&this.expand(l,!0,!0);(g||!this.collection.mayHaveChildren||this.collection.mayHaveChildren(a))&&k.add(l,"dgrid-row-expandable");return l},removeRow:function(a,
b){var c=a.connected,d={};c&&(c._handles&&(z.forEach(c._handles,function(a){a.remove()}),delete c._handles),c._rows&&(d.rows=c._rows),t("\x3e.dgrid-row",c).forEach(function(a){this.removeRow(a,!0,d)},this),c._rows&&(c._rows.length=0,delete c._rows),b||n.destroy(c));this.inherited(arguments)},_refreshCellFromItem:function(a,b){if(!a.column.renderExpando)return this.inherited(arguments);this.inherited(arguments,[a,b,{queryLevel:t(".dgrid-expando-icon",a.element)[0].level}])},cleanup:function(){this.inherited(arguments);
this.collapseOnRefresh&&(this._expanded={})},_destroyColumns:function(){this.inherited(arguments);for(var a=this._treeColumnListeners,b=a.length;b--;)a[b].remove();this._treeColumnListeners=[];this._treeColumn=null},_calcRowHeight:function(a){var b=a.connected;return this.inherited(arguments)+(b?b.offsetHeight:0)},_configureTreeColumn:function(a){var b=this,c=".dgrid-content .dgrid-column-"+a.id,d;this._treeColumn=a;if(!a._isConfiguredTreeColumn){var f=a.renderCell||this._defaultRenderCell;a._isConfiguredTreeColumn=
!0;a.renderCell=function(c,d,e,g){var l=g&&"queryLevel"in g?g.queryLevel:0,h=!b.collection.mayHaveChildren||b.collection.mayHaveChildren(c);var k=a.renderExpando(l,h,b._expanded[b.collection.getIdentity(c)],c);k.level=l;k.mayHaveChildren=h;(c=f.call(a,c,d,e,g))&&c.nodeType?(e.appendChild(k),e.appendChild(c)):e.insertBefore(k,e.firstChild)};"function"!==typeof a.renderExpando&&(a.renderExpando=this._defaultRenderExpando)}var g=this._treeColumnListeners;0===g.length&&(g.push(this.on(a.expandOn||".dgrid-expando-icon:click,"+
c+":dblclick,"+c+":keydown",function(a){var c=b.row(a);b.collection.mayHaveChildren&&!b.collection.mayHaveChildren(c.data)||"keydown"===a.type&&32!==a.keyCode||"dblclick"===a.type&&d&&1<d.count&&c.id===d.id&&-1<a.target.className.indexOf("dgrid-expando-icon")||b.expand(c);-1<a.target.className.indexOf("dgrid-expando-icon")&&(d&&d.id===b.row(a).id?d.count++:d={id:b.row(a).id,count:1})})),u("touch")&&g.push(this.on(p.selector(c,p.dbltap),function(){b.expand(this)})))},_defaultRenderExpando:function(a,
b,c){var d=this.grid.isRTL?"right":"left",f="dgrid-expando-icon";b&&(f+=" ui-icon ui-icon-triangle-1-"+(c?"se":"e"));return n.create("div",{className:f,innerHTML:"\x26nbsp;",style:"margin-"+d+": "+a*this.grid.treeIndentWidth+"px; float: "+d+";"})},_onNotification:function(a,b){"delete"===b.type&&delete this._expanded[b.id];this.inherited(arguments)},_onTreeTransitionEnd:function(a){var b=this,c=this.style.height;c&&(this.style.display="0px"===c?"none":"block");a&&(k.add(this,"dgrid-tree-resetting"),
setTimeout(function(){k.remove(b,"dgrid-tree-resetting")},0));this.style.height=""}})});
//# sourceMappingURL=Tree.js.map