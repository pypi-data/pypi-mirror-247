//>>built
define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(c,g,p,u){c=function(b){function c(a,l){var d=b[a];d&&(b[a]=function(t){var f;"put"===a&&(f=b.getIdentity(t));if(q)return d.apply(this,arguments);q=!0;try{var c=d.apply(this,arguments);p(c,function(b){l("object"==typeof b&&b||t,f)});return c}finally{q=!1}})}var m=[],v=0;b=g.delegate(b);b.notify=function(b,l){v++;for(var d=m.slice(),a=0,f=d.length;a<f;a++)d[a](b,l)};var y=b.query;b.query=function(a,
l){l=l||{};var d=y.apply(this,arguments);if(d&&d.forEach){var c=g.mixin({},l);delete c.start;delete c.count;var f=b.queryEngine&&b.queryEngine(a,c),q=v,r=[],x;d.observe=function(a,c){1==r.push(a)&&m.push(x=function(a,g){p(d,function(e){var d=e.length!=l.count,m;if(++q!=v)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var n=-1,h=-1;if(void 0!==g){var p=[].concat(e);f&&!a&&(p=f(e));var k=0;for(m=e.length;k<m;k++){var w=e[k];if(b.getIdentity(w)==g&&
!(0>p.indexOf(w))){var t=w;n=k;!f&&a||e.splice(k,1);break}}}f?a&&(f.matches?f.matches(a):f([a]).length)&&(k=-1<n?n:e.length,e.splice(k,0,a),h=u.indexOf(f(e),a),e.splice(k,1),l.start&&0==h||!d&&h==e.length?h=-1:e.splice(h,0,a)):a&&(void 0!==g?h=n:l.start||(h=b.defaultIndex||0,e.splice(h,0,a)));if((-1<n||-1<h)&&(c||!f||n!=h))for(d=r.slice(),k=0;e=d[k];k++)e(a||t,n,h)})});var g={};g.remove=g.cancel=function(){var b=u.indexOf(r,a);-1<b&&(r.splice(b,1),r.length||m.splice(u.indexOf(m,x),1))};return g}}return d};
var q;c("put",function(a,c){b.notify(a,c)});c("add",function(a){b.notify(a)});c("remove",function(a){b.notify(void 0,a)});return b};g.setObject("dojo.store.Observable",c);return c});
//# sourceMappingURL=Observable.js.map