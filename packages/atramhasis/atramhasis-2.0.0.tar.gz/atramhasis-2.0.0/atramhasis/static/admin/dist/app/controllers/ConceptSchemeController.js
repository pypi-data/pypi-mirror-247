//>>built
define("app/controllers/ConceptSchemeController","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/request/xhr dojo/Deferred dojo/store/JsonRest dojo/store/Cache dojo/store/Memory dstore/Memory dojo/json".split(" "),function(g,h,f,e,k,l,m,n,p,q){return g(null,{conceptSchemeList:null,externalSchemeStore:null,_target:"/conceptschemes",_stores:{},constructor:function(a){g.safeMixin(this,a);this.conceptSchemeList=[]},getConceptSchemes:function(){return e.get(this._target,{handleAs:"json",headers:{"Content-Type":"application/json",
Accept:"application/json"}})},getConceptScheme:function(a){return e.get(this._target+"/"+a,{handleAs:"json",headers:{"Content-Type":"application/json",Accept:"application/json"}})},getConceptSchemeFromList:function(a){var b=f.filter(this.conceptSchemeList,function(c){return c.id===a});return 0<b.length?b[0]:null},editConceptScheme:function(a){var b=q.stringify(a);return e(this._target+"/"+a.id,{handleAs:"json",method:"PUT",data:b,headers:{"Content-Type":"application/json",Accept:"application/json"}})},
loadConceptSchemeStores:function(){return this.getConceptSchemes().then(h.hitch(this,function(a){var b=[];f.forEach(a,h.hitch(this,function(a){a.label||(a.label=a.uri);-1===f.indexOf(a.subject,"external")?this.conceptSchemeList.push(a):b.push(a)}));this.externalSchemeStore=new p({idProperty:"id",data:b})}))},getConceptSchemeTree:function(a){return new m(new l({target:"/conceptschemes/"+a+"/tree",getChildren:function(a){return a.children||[]}}),new n)},getMatch:function(a,b){var c=this;return e.get("/uris/"+
a,{handleAs:"json",headers:{Accept:"application/json"}}).then(function(d){var r=d.id;return c.getConcept(d.concept_scheme.id,a).then(function(d){return{type:b,data:{id:r,label:c._getPrefLabel(d.labels,"en"),uri:a}}},function(a){throw a;})},function(a){throw a;})},getMergeMatch:function(a){var b=this;return e.get("/uris/"+a,{handleAs:"json",headers:{Accept:"application/json"}}).then(function(c){return b.getConcept(c.concept_scheme.id,a).then(function(a){return{labels:a.labels,notes:a.notes}},function(a){throw a;
})},function(a){throw a;})},getConcept:function(a,b){var c=new k,d=b.split("/").pop();a&&d||c.reject("Malformed external scheme URI");e.get("/conceptschemes/"+a+"/c/"+d,{handleAs:"json",headers:{Accept:"application/json"}}).then(function(a){var d={label:a.label,labels:a.labels,type:a.type,notes:a.notes};"collection"!=a.type&&(d.matches={exact:[b]});c.resolve(d)},function(a){c.reject(a)});return c},_getPrefLabel:function(a,b){var c=f.filter(a,function(a){return"prefLabel"==a.type});if(0==c.length)return a[0].label;
var d=f.filter(a,function(a){return a.language==b});return 0==d.length?c[0].label:d[0].label},getExternalSchemeStore:function(){return this.externalSchemeStore?this.externalSchemeStore:null},searchForConcepts:function(a,b){return e.get("/conceptschemes/"+a+"/c?label\x3d"+b+"\x26type\x3dall\x26sort\x3d+label",{handleAs:"json",headers:{Accept:"application/json"}})}})});
//# sourceMappingURL=ConceptSchemeController.js.map