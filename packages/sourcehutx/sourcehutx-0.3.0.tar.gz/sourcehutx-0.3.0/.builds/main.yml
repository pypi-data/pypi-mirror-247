# Copyright (C) 2023 Maxwell G <maxwell@gtmx.me>
# SPDX-License-Identifier: MIT
---

image: fedora/rawhide
packages:
  - pipx
  - python3.8
  - python3.9
  - python3.10-devel
  - python3.11-devel
  - python3-devel
sources:
  - https://git.sr.ht/~gotmax23/sourcehutx
secrets:
  # gotmax23/sourcehut-dev webhook
  - e89da99e-bfb0-4056-8b37-c1b09b7881bf
tasks:
  - setup: |
      pipx install nox
      pipx install git+https://git.sr.ht/~gotmax23/releaserr
  - copr-webhook: |
      cd sourcehutx
      releaserr copr-webhook ~/.copr-dev-hook --branch origin/main --skip-if-missing
  - nox-test: |
      cd sourcehutx
      nox -v -t test -- --cov=sourcehut
  - nox-coverage: |
      cd sourcehutx
      nox -v -e coverage
  - nox-lint: |
      cd sourcehutx
      nox -v -e lint
