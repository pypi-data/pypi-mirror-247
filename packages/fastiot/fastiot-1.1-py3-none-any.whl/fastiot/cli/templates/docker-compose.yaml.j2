# This file has been autogenerated. It is highly recommended to not edit it directly.
# Instead, if you need to do customizations, please consider using a "docker-compose.override.yaml" file.

version: "2.4"

{% if environment_for_docker_compose_file|length > 0 %}
x-env: &env_var
{% for item in environment_for_docker_compose_file %}
  {{item}}: "{{environment_for_docker_compose_file[item]}}"
{% endfor %}

{% endif %}
x-logging: &logging_var
  driver: "{{ deployment_config.logging_config.log_driver }}"
  options:
{% if deployment_config.logging_config.max_size %}
    "max-size": "{{ deployment_config.logging_config.max_size }}"
{% endif %}
{% if deployment_config.logging_config.max_file %}
    "max-file": "{{ deployment_config.logging_config.max_file }}"
{% endif %}
{% for option_name, option in deployment_config.logging_config.additional_options.items() %}
    "{{option_name}}": "{{ option }}"
{% endfor %}


services:
{% for service in services %}
  {{ service.name }}:
    image: "{{ service.image }}"
{% if service.environment|length > 0 or environment_for_docker_compose_file|length > 0 %}
    environment:
{% if environment_for_docker_compose_file|length > 0 %}
      <<: *env_var
{% endif %}
{% for item in service.environment %}
      {{item}}: "{{service.environment[item]}}"
{% endfor %}
{% endif %}
{% if env_file %}
    env_file:
      - .env
{% endif %}
{% if service.ports|length > 0 %}
    ports:
{% for item in service.ports %}
      - "{{ item }}"
{% endfor %}
{% endif %}
{% if service.labels|length > 0 %}
    labels:
{% for item in service.labels %}
      - "{{ item }}"
{% endfor %}
{% endif %}
{% if service.extras|length > 0 %}
{% filter indent(width=4) %}
    {{ service.extras }}
{% endfilter %}
{% endif %}
{% if service.devices|length > 0 %}
    devices:
{% for item in service.devices %}
      - "{{ item }}"
{% endfor %}
{% endif %}
{% if service.volumes|length > 0 %}
    volumes:
{% for item in service.volumes %}
      - "{{ item }}"
{% endfor %}
{% endif %}
{% if service.tmpfs|length > 0 %}
    tmpfs:
{% for item in service.tmpfs %}
      - "{{ item }}"
{% endfor %}
{% endif %}
{% if service.privileged %}
    privileged: true
{% endif %}
    networks:
      - "{{ docker_net_name }}"
{% for item in service.extra_networks %}
      - "{{ item }}"
{% endfor %}
    logging:
      <<: *logging_var
    restart: always


{% endfor %}
networks:
  {{ docker_net_name }}:
{% for net in external_networks %}
  {{ net }}:
    external: true
    name: {{ net }}
{% endfor %}
