import{r as f,w as Y,D as L,y as _,x as de,z as b,R as q,A as me,B as se,F as $,X as z,I as H,G as ie,H as pe,J as fe,K as U,M as xe,T as ve,Q as g,U as he,V as G,W as ge,Y as X,Z as oe,$ as ye,u as le,a0 as D,a as I,a1 as be,n as Ie,a2 as we,a3 as Pe,j as t,a4 as O,a5 as T,c as S,S as je,e as k,a6 as Ee,d as R,a7 as ce,o as Z,a8 as ee,a9 as K,aa as Ne,ab as Re,E as Se,ac as ke}from"./index-f910e241.js";import{C as Me,I as te}from"./SearchList-b423259a.js";import{F as Ce,E as P,C as De,P as ne}from"./PlanChangePreview-3f0b2d33.js";import{c as Ae,d as Fe,e as N,x as Te}from"./context-5b5a8e86.js";import{s as $e,k as ae}from"./popover-e9b430b5.js";import{M as Oe}from"./disclosure-ee4a51d2.js";import"./ModelLineage-1b01d10c.js";import"./PlusIcon-2f8bfc84.js";import"./_commonjs-dynamic-modules-302442b1.js";function Le({title:e,titleId:r,...a},s){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":r},a),e?f.createElement("title",{id:r},e):null,f.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"}))}const _e=f.forwardRef(Le),ze=_e;var Be=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Be||{}),Qe=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Qe||{}),Ue=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(Ue||{});function V(e,r=a=>a){let a=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,s=ye(r(e.items.slice()),u=>u.dataRef.current.domRef.current),i=a?s.indexOf(a):null;return i===-1&&(i=null),{items:s,activeItemIndex:i}}let Ke={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,r)=>{var a;let s=V(e),i=Te(r,{resolveItems:()=>s.items,resolveActiveIndex:()=>s.activeItemIndex,resolveId:u=>u.id,resolveDisabled:u=>u.dataRef.current.disabled});return{...e,...s,searchQuery:"",activeItemIndex:i,activationTrigger:(a=r.trigger)!=null?a:1}},3:(e,r)=>{let a=e.searchQuery!==""?0:1,s=e.searchQuery+r.value.toLowerCase(),i=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+a).concat(e.items.slice(0,e.activeItemIndex+a)):e.items).find(l=>{var n;return((n=l.dataRef.current.textValue)==null?void 0:n.startsWith(s))&&!l.dataRef.current.disabled}),u=i?e.items.indexOf(i):-1;return u===-1||u===e.activeItemIndex?{...e,searchQuery:s}:{...e,searchQuery:s,activeItemIndex:u,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,r)=>{let a=V(e,s=>[...s,{id:r.id,dataRef:r.dataRef}]);return{...e,...a}},6:(e,r)=>{let a=V(e,s=>{let i=s.findIndex(u=>u.id===r.id);return i!==-1&&s.splice(i,1),s});return{...e,...a,activationTrigger:1}}},J=f.createContext(null);J.displayName="MenuContext";function B(e){let r=f.useContext(J);if(r===null){let a=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,B),a}return r}function Ve(e,r){return se(r.type,Ke,e,r)}let Ge=f.Fragment;function He(e,r){let{__demoMode:a=!1,...s}=e,i=f.useReducer(Ve,{__demoMode:a,menuState:a?0:1,buttonRef:f.createRef(),itemsRef:f.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:u,itemsRef:l,buttonRef:n},d]=i,p=_(r);de([n,l],(j,v)=>{var o;d({type:1}),xe(v,ve.Loose)||(j.preventDefault(),(o=n.current)==null||o.focus())},u===0);let h=b(()=>{d({type:1})}),x=f.useMemo(()=>({open:u===0,close:h}),[u,h]),m={ref:p};return q.createElement(J.Provider,{value:i},q.createElement(me,{value:se(u,{0:$.Open,1:$.Closed})},z({ourProps:m,theirProps:s,slot:x,defaultTag:Ge,name:"Menu"})))}let Je="button";function We(e,r){var a;let s=H(),{id:i=`headlessui-menu-button-${s}`,...u}=e,[l,n]=B("Menu.Button"),d=_(l.buttonRef,r),p=ie(),h=b(o=>{switch(o.key){case g.Space:case g.Enter:case g.ArrowDown:o.preventDefault(),o.stopPropagation(),n({type:0}),p.nextFrame(()=>n({type:2,focus:N.First}));break;case g.ArrowUp:o.preventDefault(),o.stopPropagation(),n({type:0}),p.nextFrame(()=>n({type:2,focus:N.Last}));break}}),x=b(o=>{switch(o.key){case g.Space:o.preventDefault();break}}),m=b(o=>{if(he(o.currentTarget))return o.preventDefault();e.disabled||(l.menuState===0?(n({type:1}),p.nextFrame(()=>{var w;return(w=l.buttonRef.current)==null?void 0:w.focus({preventScroll:!0})})):(o.preventDefault(),n({type:0})))}),j=f.useMemo(()=>({open:l.menuState===0}),[l]),v={ref:d,id:i,type:$e(e,l.buttonRef),"aria-haspopup":"menu","aria-controls":(a=l.itemsRef.current)==null?void 0:a.id,"aria-expanded":l.menuState===0,onKeyDown:h,onKeyUp:x,onClick:m};return z({ourProps:v,theirProps:u,slot:j,defaultTag:Je,name:"Menu.Button"})}let Ye="div",qe=Y.RenderStrategy|Y.Static;function Xe(e,r){var a,s;let i=H(),{id:u=`headlessui-menu-items-${i}`,...l}=e,[n,d]=B("Menu.Items"),p=_(n.itemsRef,r),h=pe(n.itemsRef),x=ie(),m=fe(),j=(()=>m!==null?(m&$.Open)===$.Open:n.menuState===0)();f.useEffect(()=>{let c=n.itemsRef.current;c&&n.menuState===0&&c!==(h==null?void 0:h.activeElement)&&c.focus({preventScroll:!0})},[n.menuState,n.itemsRef,h]),Ce({container:n.itemsRef.current,enabled:n.menuState===0,accept(c){return c.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:c.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(c){c.setAttribute("role","none")}});let v=b(c=>{var C,A;switch(x.dispose(),c.key){case g.Space:if(n.searchQuery!=="")return c.preventDefault(),c.stopPropagation(),d({type:3,value:c.key});case g.Enter:if(c.preventDefault(),c.stopPropagation(),d({type:1}),n.activeItemIndex!==null){let{dataRef:y}=n.items[n.activeItemIndex];(A=(C=y.current)==null?void 0:C.domRef.current)==null||A.click()}oe(n.buttonRef.current);break;case g.ArrowDown:return c.preventDefault(),c.stopPropagation(),d({type:2,focus:N.Next});case g.ArrowUp:return c.preventDefault(),c.stopPropagation(),d({type:2,focus:N.Previous});case g.Home:case g.PageUp:return c.preventDefault(),c.stopPropagation(),d({type:2,focus:N.First});case g.End:case g.PageDown:return c.preventDefault(),c.stopPropagation(),d({type:2,focus:N.Last});case g.Escape:c.preventDefault(),c.stopPropagation(),d({type:1}),G().nextFrame(()=>{var y;return(y=n.buttonRef.current)==null?void 0:y.focus({preventScroll:!0})});break;case g.Tab:c.preventDefault(),c.stopPropagation(),d({type:1}),G().nextFrame(()=>{ge(n.buttonRef.current,c.shiftKey?X.Previous:X.Next)});break;default:c.key.length===1&&(d({type:3,value:c.key}),x.setTimeout(()=>d({type:4}),350));break}}),o=b(c=>{switch(c.key){case g.Space:c.preventDefault();break}}),w=f.useMemo(()=>({open:n.menuState===0}),[n]),E={"aria-activedescendant":n.activeItemIndex===null||(a=n.items[n.activeItemIndex])==null?void 0:a.id,"aria-labelledby":(s=n.buttonRef.current)==null?void 0:s.id,id:u,onKeyDown:v,onKeyUp:o,role:"menu",tabIndex:0,ref:p};return z({ourProps:E,theirProps:l,slot:w,defaultTag:Ye,features:qe,visible:j,name:"Menu.Items"})}let Ze=f.Fragment;function et(e,r){let a=H(),{id:s=`headlessui-menu-item-${a}`,disabled:i=!1,...u}=e,[l,n]=B("Menu.Item"),d=l.activeItemIndex!==null?l.items[l.activeItemIndex].id===s:!1,p=f.useRef(null),h=_(r,p);U(()=>{if(l.__demoMode||l.menuState!==0||!d||l.activationTrigger===0)return;let y=G();return y.requestAnimationFrame(()=>{var Q,W;(W=(Q=p.current)==null?void 0:Q.scrollIntoView)==null||W.call(Q,{block:"nearest"})}),y.dispose},[l.__demoMode,p,d,l.menuState,l.activationTrigger,l.activeItemIndex]);let x=Ae(p),m=f.useRef({disabled:i,domRef:p,get textValue(){return x()}});U(()=>{m.current.disabled=i},[m,i]),U(()=>(n({type:5,id:s,dataRef:m}),()=>n({type:6,id:s})),[m,s]);let j=b(()=>{n({type:1})}),v=b(y=>{if(i)return y.preventDefault();n({type:1}),oe(l.buttonRef.current)}),o=b(()=>{if(i)return n({type:2,focus:N.Nothing});n({type:2,focus:N.Specific,id:s})}),w=Fe(),E=b(y=>w.update(y)),c=b(y=>{w.wasMoved(y)&&(i||d||n({type:2,focus:N.Specific,id:s,trigger:0}))}),C=b(y=>{w.wasMoved(y)&&(i||d&&n({type:2,focus:N.Nothing}))}),A=f.useMemo(()=>({active:d,disabled:i,close:j}),[d,i,j]);return z({ourProps:{id:s,ref:h,role:"menuitem",tabIndex:i===!0?void 0:-1,"aria-disabled":i===!0?!0:void 0,disabled:void 0,onClick:v,onFocus:o,onPointerEnter:E,onMouseEnter:E,onPointerMove:c,onMouseMove:c,onPointerLeave:C,onMouseLeave:C},theirProps:u,slot:A,defaultTag:Ze,name:"Menu.Item"})}let tt=L(He),nt=L(We),at=L(Xe),rt=L(et),F=Object.assign(tt,{Button:nt,Items:at,Item:rt});function vt(){const{setIsPlanOpen:e}=le(),r=D(m=>m.planOverview),a=D(m=>m.planAction),s=D(m=>m.setPlanAction),i=I(m=>m.addConfirmation),u=I(m=>m.setShowConfirmation),l=I(m=>m.environment),n=I(m=>m.environments),{isFetching:d}=be(),[p,h]=f.useState(!1);f.useEffect(()=>{p&&(x(),h(!1))},[p]);function x(){Ie(r.skipTests)&&s(new we({value:Pe.Run})),e(!0)}return t.jsxs("div",{className:"flex items-center",children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(O,{className:"mx-0 rounded-none rounded-l-lg border-r",variant:T.Alternative,size:S.sm,onClick:m=>{m.stopPropagation(),a.isProcessing?e(!0):l.isProd&&l.isSyncronized?i({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${l.name}`,noText:"No, Cancel",action(){x()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${n.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[n.size>1&&t.jsx(re,{className:"mr-2",side:"left",showAddEnvironment:!1,onSelect:()=>{h(!0),u(!1)},size:S.md,disabled:a.isProcessing}),t.jsx(ue,{className:"w-full",size:S.md,onAdd:()=>{h(!0),u(!1)}})]})]})}):x()},children:[a.isProcessing&&t.jsx(je,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:a.displayStatus(r)})]}),t.jsx(re,{className:"rounded-none rounded-r-lg border-l mx-0",disabled:d||a.isProcessing||l.isInitialProd})]}),t.jsx(st,{}),t.jsx(it,{})]})}function st(){const e=I(a=>a.environment),r=D(a=>a.planOverview);return t.jsxs("span",{className:"flex align-center h-full w-full",children:[e.isProd?t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-warning-10 text-warning-700  dark:text-warning-400 text-xs text-center",children:"Production"}):e.isDefault?t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:"Default"}):t.jsx(t.Fragment,{}),e.isInitial&&t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),e.isSyncronized&&r.isLatest&&t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:"Latest"})]})}function it(){var r,a,s,i,u,l,n,d;const e=D(p=>p.planOverview);return t.jsxs("span",{className:"flex align-center h-full w-full",children:[k(e.added)&&t.jsx(M,{headline:"Added Models",type:P.Add,changes:e.added??[]}),k((r=e.modified)==null?void 0:r.direct)&&t.jsx(M,{headline:"Direct Changes",type:P.Direct,changes:((a=e.modified)==null?void 0:a.direct.map(({model_name:p})=>({name:p})))??[]}),k((s=e.modified)==null?void 0:s.indirect)&&t.jsx(M,{headline:"Indirectly Modified",type:P.Indirect,changes:((i=e.modified)==null?void 0:i.indirect.map(({model_name:p})=>({name:p})))??[]}),k((u=e.modified)==null?void 0:u.metadata)&&t.jsx(M,{headline:"Metadata Changes",type:P.Default,changes:((l=e.modified)==null?void 0:l.metadata)??[]}),k(e.removed)&&t.jsx(M,{headline:"Removed Models",type:P.Remove,changes:e.removed??[]}),k((n=e.backfills)==null?void 0:n.models)&&t.jsx(M,{headline:"Backfills",type:P.Default,changes:((d=e.backfills)==null?void 0:d.models.map(({model_name:p,view_name:h})=>({name:p??h})))??[]})]})}function re({onSelect:e,disabled:r,side:a=K.Right,className:s,showAddEnvironment:i=!0,size:u=S.sm}){const{addError:l}=le(),n=I(v=>v.environment),d=I(v=>v.environments),p=I(v=>v.setEnvironment),h=I(v=>v.removeLocalEnvironment),x=Ee(F.Button);function m(v){Re(v.name).then(()=>{h(v)}).catch(o=>{l(Se.Environments,o)})}function j(v){ke({environment:v.name,plan_options:{skip_tests:!0,include_unmodified:!0}})}return t.jsx(F,{children:({close:v})=>t.jsxs(t.Fragment,{children:[t.jsxs(x,{variant:T.Alternative,size:u,disabled:r,className:R(s),children:[t.jsx("span",{className:R("block overflow-hidden truncate",(n.isLocal||r)&&"text-neutral-500",n.isRemote&&"text-primary-500"),children:n.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Me,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(ce,{as:f.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:R("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",a===K.Left&&"left-0",a===K.Right&&"right-0"),children:[t.jsxs(F.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(d).map(o=>t.jsx(F.Item,{children:({active:w})=>t.jsxs("div",{onClick:E=>{E.stopPropagation(),p(o),j(o),e==null||e()},className:R("flex justify-between items-center pl-2 pr-1 py-1 cursor-pointer overflow-auto",w&&"bg-primary-10",o===n&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(De,{className:R("w-4 h-4 text-primary-500 mt-1.5",w&&"opacity-10",o!==n&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:R("block truncate ml-2",o.isRemote&&"text-primary-500"),children:o.name}),t.jsxs("small",{className:"block ml-2",children:["(",o.type,")"]})]}),o.isProd&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Production Environment"})}),o.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),t.jsxs("div",{className:"flex items-center",children:[o.isPinned&&t.jsx(ze,{title:"Pinned",className:"w-4 text-primary-500 dark:text-primary-100 mx-1"}),Z(o.isPinned)&&o.isLocal&&o!==n&&t.jsx(O,{className:"!m-0 !px-2 bg-transparent hover:bg-transparent border-none",size:S.xs,variant:T.Neutral,onClick:E=>{E.stopPropagation(),h(o)},children:t.jsx(Oe,{className:"w-4 text-neutral-500 dark:text-neutral-100"})}),Z(o.isPinned)&&o.isRemote&&o!==n&&t.jsx(O,{className:"!px-2 !my-0",size:S.xs,variant:T.Danger,onClick:E=>{E.stopPropagation(),m(o)},children:"Delete"})]})]})},o.name)),i&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx(ue,{onAdd:v,className:"mt-2 px-2"})]})]}),t.jsx(ee,{})]})})]})})}function ue({onAdd:e,className:r,label:a="Add",size:s=S.sm}){const i=I(x=>x.getNextEnvironment),u=I(x=>x.isExistingEnvironment),l=I(x=>x.addLocalEnvironment),[n,d]=f.useState(""),[p,h]=f.useState(i().name);return t.jsxs("div",{className:R("flex w-full items-center",r),children:[t.jsx(te,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:s,children:({className:x})=>t.jsx(te.Textfield,{className:R(x,"w-full"),placeholder:"Environment",value:n,onInput:m=>{m.stopPropagation(),d(m.target.value)}})}),t.jsx(O,{className:"my-0 mx-0 font-bold",size:s,disabled:Ne(n)||u(n),onClick:x=>{x.stopPropagation(),l(n,p),d(""),h(i().name),e==null||e()},children:a})]})}function M({headline:e,type:r,changes:a}){const[s,i]=f.useState(!1);return t.jsx(ae,{onMouseEnter:()=>{i(!0)},onMouseLeave:()=>{i(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:R("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",r===P.Add&&"bg-success-500 border-success-500",r===P.Remove&&"bg-danger-500 border-danger-500",r===P.Direct&&"bg-secondary-500 border-secondary-500",r===P.Indirect&&"bg-warning-500 border-warning-500",r===P.Default&&"bg-neutral-500 border-neutral-500"),children:a.length}),t.jsx(ce,{show:s,as:f.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(ae.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(ne,{headline:e,type:r,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto hover:scrollbar scrollbar--vertical",children:t.jsx(ne.Default,{type:r,changes:a})})})})]})})}export{vt as default};
